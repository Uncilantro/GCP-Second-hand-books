{"version":3,"file":"wodedingdan.js","sources":["pages/wodedingdan/wodedingdan.vue","D:/develop/HBuilderX.4.24.2024072208/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvd29kZWRpbmdkYW4vd29kZWRpbmdkYW4udnVl"],"sourcesContent":["<template>\r\n    <view>\r\n        <view v-if=\"collection.length > 0\" class=\"bookbox\" v-for=\"book in collection\" :key=\"book.id\">\r\n            <image :src=\"book.img\" mode=\"aspectFill\" class=\"bookimage\"></image>\r\n            <view class=\"bookright\">\r\n                <view class=\"item-title\">\r\n                    {{ book.title || book.id }}\r\n                    <text v-if=\"book.jiage !== undefined\" class=\"tag tag-price\">￥{{ book.jiage }}</text>\r\n                    <text v-if=\"book.xiaoqv\" class=\"tag tag-xiaoqv\">{{ book.xiaoqv }}</text>\r\n                    <text v-if=\"book.phone\" class=\"tag tag-phone\">{{ book.phone }}</text>\r\n                </view>\r\n                <view class=\"item-contact\">{{ book.contact }}</view>\r\n                <image :src=\"book.image\" class=\"item-image\" v-if=\"book.image\" />\r\n            </view>\r\n            <image class=\"yichu\" src=\"../../static/移出购物车.png\" @click=\"removeFromCollection(book)\" mode=\"\"></image>\r\n        </view>\r\n        <view v-else class=\"no-collection\">\r\n            暂无订单\r\n        </view>\r\n\r\n        <view class=\"checkout-bar\" v-if=\"collection.length > 0\">\r\n            <view class=\"total-info\">\r\n                <view>共 {{ totalBooks }} 本书</view>\r\n                <view>总价：￥{{ totalPrice }}</view>\r\n            </view>\r\n        </view>\r\n        <view v-if=\"collection.length > 0\" class=\"trade-tip\">出于安全考虑，目前只支持校内线下交易</view>\r\n    </view>\r\n</template>\r\n\r\n<script>\r\n    import {\r\n        ref,\r\n        computed,\r\n        onMounted\r\n    } from \"vue\";\r\n    import {\r\n        onLoad\r\n    } from \"@dcloudio/uni-app\";\r\n\r\n    // 模拟生成支付参数\r\n    const generateMockPayParams = (totalPrice) => {\r\n        return {\r\n            appId: 'wxc7f155a01020bd49', // 确保这里是你在微信开放平台注册的小程序 AppID\r\n            timeStamp: new Date().getTime().toString(),\r\n            nonceStr: Math.random().toString(36).substr(2, 15),\r\n            package: `prepay_id=your_prepay_id_${new Date().getTime()}`, // 替换为你的预支付订单号\r\n            signType: 'MD5',\r\n            paySign: 'your_pay_sign' // 替换为你的支付签名\r\n        };\r\n    };\r\n\r\n    export default {\r\n        setup() {\r\n            const collection = ref([]);\r\n\r\n            onMounted(() => {\r\n                const storedCollection = uni.getStorageSync('myCollection');\r\n                if (storedCollection) {\r\n                    collection.value = storedCollection;\r\n                    console.log('Loaded collection:', collection.value); // 调试信息\r\n                } else {\r\n                    console.log('No collection found in storage'); // 调试信息\r\n                }\r\n            });\r\n\r\n            const removeFromCollection = (book) => {\r\n                const index = collection.value.findIndex(item => item.id === book.id);\r\n                if (index !== -1) {\r\n                    collection.value.splice(index, 1);\r\n                    uni.setStorageSync('myCollection', collection.value);\r\n                    uni.showToast({\r\n                        title: '已从收藏中移除',\r\n                        icon: 'success'\r\n                    });\r\n                }\r\n            };\r\n\r\n            const addToCart = (book) => {\r\n                let cart = uni.getStorageSync('myCart') || [];\r\n                cart.push(book);\r\n                uni.setStorageSync('myCart', cart);\r\n                uni.showToast({\r\n                    title: '已添加到购物车',\r\n                    icon: 'success'\r\n                });\r\n            };\r\n\r\n            const totalBooks = computed(() => collection.value.length);\r\n            const totalPrice = computed(() => collection.value.reduce((sum, book) => sum + parseFloat(book.jiage), 0)\r\n                .toFixed(2));\r\n\r\n            // 移除支付相关功能\r\n            return {\r\n                collection,\r\n                removeFromCollection,\r\n                addToCart,\r\n                totalBooks,\r\n                totalPrice\r\n            };\r\n        }\r\n    };\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n    .item-title {\r\n        font-weight: bold;\r\n        margin-bottom: 5px;\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        align-items: center;\r\n        gap: 6px;\r\n    }\r\n    .tag {\r\n        display: inline-block;\r\n        font-size: 12px;\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        margin-left: 5px;\r\n        margin-top: 2px;\r\n        white-space: nowrap;\r\n        max-width: 90px;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n    }\r\n    .tag-price {\r\n        background: #e6f7e6;\r\n        color: #328d64;\r\n        border: 1px solid #b2e2b2;\r\n    }\r\n    .tag-xiaoqv {\r\n        background: #e6f0fa;\r\n        color: #3a6ea5;\r\n        border: 1px solid #b3cde8;\r\n    }\r\n    .tag-phone {\r\n        background: #fff7e6;\r\n        color: #b26a00;\r\n        border: 1px solid #ffe0b2;\r\n    }\r\n    .item-contact {\r\n        margin-bottom: 5px;\r\n    }\r\n    .item-image {\r\n        width: 100px;\r\n        height: 100px;\r\n        border-radius: 5px;\r\n    }\r\n\r\n    .trade-tip {\r\n        text-align: center;\r\n        color: #888;\r\n        font-size: 24rpx;\r\n        margin: 20rpx 0 40rpx 0;\r\n    }\r\n    .no-collection {\r\n        text-align: center;\r\n        font-size: 18px;\r\n        color: #999;\r\n        margin-top: 50px;\r\n    }\r\n\r\n    .yichu {\r\n        width: 100rpx;\r\n        height: 100rpx;\r\n        position: relative;\r\n        left: 10rpx;\r\n        top: 120rpx;\r\n        z-index: 100;\r\n    }\r\n\r\n    .value {\r\n        font-size: 36rpx;\r\n        font-weight: bolder;\r\n        color: red;\r\n    }\r\n\r\n    .bookright {\r\n        line-height: 100rpx;\r\n        width: 400rpx;\r\n        font-size: 28rpx;\r\n        font-weight: bold;\r\n        color: #797979;\r\n        margin-left: 40rpx;\r\n\r\n    }\r\n\r\n    .booktitle {\r\n        font-weight: bolder;\r\n        display: -webkit-box;\r\n        -webkit-box-orient: vertical;\r\n        -webkit-line-clamp: 1;\r\n        overflow: hidden;\r\n\r\n        .title {\r\n            color: black;\r\n            font-size: 36rpx;\r\n        }\r\n    }\r\n\r\n    .bookbox {\r\n        width: 90%;\r\n        height: 350rpx;\r\n        box-shadow: 5rpx 5rpx 5rpx 0 rgba(0, 0, 0, 0.5);\r\n        padding: 20rpx;\r\n        margin: 40rpx auto;\r\n        border-radius: 30rpx;\r\n        border: 5rpx solid #ccc;\r\n        display: flex;\r\n        flex: 1;\r\n    }\r\n\r\n    .bookimage {\r\n        width: 200rpx;\r\n        height: 300rpx;\r\n        margin-top: 20rpx;\r\n    }\r\n\r\n    .checkout-bar {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        padding: 20rpx;\r\n        background-color: #f4f4f4;\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        box-shadow: 0 -5rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\r\n        .total-info {\r\n            font-size: 32rpx;\r\n            color: #333;\r\n        }\r\n\r\n        .checkout-button {\r\n            background-color: #007aff;\r\n            color: #fff;\r\n            font-size: 32rpx;\r\n            padding: 10rpx 40rpx;\r\n            border: none;\r\n            border-radius: 10rpx;\r\n        }\r\n    }\r\n</style>","import MiniProgramPage from 'C:/Users/CHZ/Documents/GitHub/GCP-Second-hand-books/pages/wodedingdan/wodedingdan.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","computed"],"mappings":";;;AAoDI,MAAK,YAAU;AAAA,EACX,QAAQ;AACJ,UAAM,aAAaA,kBAAI,CAAA,CAAE;AAEzBC,kBAAAA,UAAU,MAAM;AACZ,YAAM,mBAAmBC,cAAAA,MAAI,eAAe,cAAc;AAC1D,UAAI,kBAAkB;AAClB,mBAAW,QAAQ;AACnBA,sBAAA,MAAA,MAAA,OAAA,2CAAY,sBAAsB,WAAW,KAAK;AAAA,aAC/C;AACHA,sBAAAA,MAAA,MAAA,OAAA,2CAAY,gCAAgC;AAAA,MAChD;AAAA,IACJ,CAAC;AAED,UAAM,uBAAuB,CAAC,SAAS;AACnC,YAAM,QAAQ,WAAW,MAAM,UAAU,UAAQ,KAAK,OAAO,KAAK,EAAE;AACpE,UAAI,UAAU,IAAI;AACd,mBAAW,MAAM,OAAO,OAAO,CAAC;AAChCA,sBAAAA,MAAI,eAAe,gBAAgB,WAAW,KAAK;AACnDA,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAC;AAAA,MACL;AAAA;AAGJ,UAAM,YAAY,CAAC,SAAS;AACxB,UAAI,OAAOA,cAAG,MAAC,eAAe,QAAQ,KAAK,CAAA;AAC3C,WAAK,KAAK,IAAI;AACdA,oBAAAA,MAAI,eAAe,UAAU,IAAI;AACjCA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MACV,CAAC;AAAA;AAGL,UAAM,aAAaC,cAAAA,SAAS,MAAM,WAAW,MAAM,MAAM;AACzD,UAAM,aAAaA,cAAQ,SAAC,MAAM,WAAW,MAAM,OAAO,CAAC,KAAK,SAAS,MAAM,WAAW,KAAK,KAAK,GAAG,CAAC,EACnG,QAAQ,CAAC,CAAC;AAGf,WAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;EAER;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnGR,GAAG,WAAW,eAAe;"}