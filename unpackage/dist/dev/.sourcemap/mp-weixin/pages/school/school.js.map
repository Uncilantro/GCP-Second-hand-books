{"version":3,"file":"school.js","sources":["pages/school/school.vue","D:/develop/HBuilderX.4.24.2024072208/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2Nob29sL3NjaG9vbC52dWU"],"sourcesContent":["<template>\n    <view>\n        <tui-tabs sliderWidth=\"150\" sliderHeight=\"80\" sliderRadius=\"25rpx\" selected-color=\"#fff\" bold=\"true\"\n            sliderBgColor=\"#328d64\" height=\"90\" :tabs=\"tabs\" :currentTab=\"currentTab\" @change=\"change\"\n            class=\"nav-container\"></tui-tabs>\n\n        <view v-for=\"(item, index) in filteredData\" :key=\"index\" class=\"item\">\n            <image :src=\"item.img\" class=\"item-img\" />\n            <view class=\"item-content\">\n                <view class=\"item-title\">\n                  {{ item.title }}\n                  <text v-if=\"item.jiage !== undefined\" class=\"tag tag-price\">￥{{ item.jiage }}</text>\n                  <text v-if=\"item.xiaoqv\" class=\"tag tag-xiaoqv\">{{ item.xiaoqv }}</text>\n                  <text v-if=\"item.phone\" class=\"tag tag-phone\">{{ item.phone }}</text>\n                </view>\n                <view class=\"item-contact\">{{ item.contact }}</view>\n                <image :src=\"item.image\" class=\"item-image\" />\n                <view class=\"dianzanbox\" @click.stop=\"addTofavorite(item)\">\n                    <image class=\"dianzan\" src=\"../../static/赞.png\" mode=\"\"></image>\n                    <view class=\"shoucantext\">加入收藏夹</view>\n                </view>\n            </view>\n        </view>\n    </view>\n</template>\n\n<script>\n    import tuiTabs from \"../../node_modules/thorui-uni/lib/thorui/tui-tabs/tui-tabs.vue\";\n\n    export default {\n        components: {\n            tuiTabs\n        },\n        data() {\n            return {\n                currentTab: 0,\n                tabs: [{\n                        name: '我要买书'\n                    },\n                    {\n                        name: '我要卖书'\n                    }\n                ],\n                fabuData: [], // fabu.js数据\n                bookData: []  // bookdate.js数据\n            };\n        },\n        computed: {\n            filteredData() {\n                // 只展示fabuData，和原有逻辑一致\n                const typeMap = {\n                    0: '我要买书',\n                    1: '我要卖书'\n                };\n                if (!Array.isArray(this.fabuData)) return [];\n                return this.fabuData.filter(item => item.type === typeMap[this.currentTab]);\n            }\n        },\n        methods: {\n            change(e) {\n                this.currentTab = e.index; // 确保当前选中的标签索引被正确更新\n            },\n            addTofavorite(book) {\n                console.log('Adding to favorite:', book); // 调试信息\n                let favorite = uni.getStorageSync('myFavorite') || [];\n                favorite.push(book);\n                uni.setStorageSync('myFavorite', favorite);\n                uni.showToast({\n                    title: '已添加到收藏夹',\n                    icon: 'success'\n                });\n            }\n        },\n        onLoad() {\n            // 登录校验\n            const user = uni.getStorageSync('user');\n            if (!user || !user.title) {\n                uni.showToast({\n                    title: '该功能需要登录后使用',\n                    icon: 'none',\n                    duration: 1500\n                });\n                setTimeout(() => {\n                    uni.redirectTo({ url: '/pages/login/login' });\n                }, 200);\n                return;\n            }\n            // 页面加载时分别请求后端数据\n            uni.request({\n                url: 'http://localhost:3000/api/fabu',\n                method: 'GET',\n                success: (res) => {\n                    if (Array.isArray(res.data)) {\n                        this.fabuData = res.data;\n                    } else if (res.data && Array.isArray(res.data.data)) {\n                        this.fabuData = res.data.data;\n                    } else {\n                        this.fabuData = [];\n                    }\n                },\n                fail: () => {\n                    uni.showToast({\n                        title: '获取发布数据失败',\n                        icon: 'none'\n                    });\n                    this.fabuData = [];\n                }\n            });\n            uni.request({\n                url: 'http://localhost:3000/api/bookdate',\n                method: 'GET',\n                success: (res) => {\n                    if (Array.isArray(res.data)) {\n                        this.bookData = res.data;\n                    } else if (res.data && Array.isArray(res.data.data)) {\n                        this.bookData = res.data.data;\n                    } else {\n                        this.bookData = [];\n                    }\n                },\n                fail: () => {\n                    uni.showToast({\n                        title: '获取书籍数据失败',\n                        icon: 'none'\n                    });\n                    this.bookData = [];\n                }\n            });\n        }\n    };\n</script>\n\n<style>\n    .dianzanbox {\n        display: flex;\n        width: 250rpx;\n        position: relative;\n        top: 70rpx;\n        float: right;\n        border-radius: 30rpx;\n        padding: 10rpx;\n        border: 5rpx solid #ccc;\n        box-shadow: 5rpx 5rpx 5rpx 0 rgba(0, 0, 0, 0.5);\n\n    }\n\n    .shoucantext {\n        font-weight: bold;\n        font-size: 26rpx;\n        color: #d81e06;\n        margin-left: 15rpx;\n        display: flex;\n        align-items: center;\n\n    }\n\n    .dianzan {\n        width: 100rpx;\n        height: 100rpx;\n\n\n    }\n\n    .item {\n        margin: 10px;\n        padding: 10px;\n        box-shadow: 15rpx 15rpx 15rpx 0 rgba(0, 0, 0, 0.5);\n        border: 1px solid #ccc;\n        border-radius: 15px;\n        display: flex;\n        align-items: center;\n        background-color: #f2f2f2;\n        box-sizing: border-box;\n    }\n\n    .item-img {\n        width: 50px;\n        height: 50px;\n        margin-right: 10px;\n        margin-bottom: 250rpx;\n        border-radius: 50rpx;\n    }\n\n    .item-content {\n        flex: 1;\n    }\n\n    .item-title {\n        font-weight: bold;\n        margin-bottom: 5px;\n        display: flex;\n        flex-wrap: wrap;\n        align-items: center;\n        gap: 6px;\n    }\n\n    .tag {\n        display: inline-block;\n        font-size: 12px;\n        padding: 2px 8px;\n        border-radius: 10px;\n        margin-left: 5px;\n        margin-top: 2px;\n        white-space: nowrap;\n        max-width: 90px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n    }\n    .tag-price {\n        background: #e6f7e6;\n        color: #328d64;\n        border: 1px solid #b2e2b2;\n    }\n    .tag-xiaoqv {\n        background: #e6f0fa;\n        color: #3a6ea5;\n        border: 1px solid #b3cde8;\n    }\n    .tag-phone {\n        background: #fff7e6;\n        color: #b26a00;\n        border: 1px solid #ffe0b2;\n    }\n\n    .item-contact {\n        margin-bottom: 5px;\n    }\n\n    .item-image {\n        width: 100px;\n        height: 100px;\n        border-radius: 5px;\n    }\n</style>","import MiniProgramPage from 'C:/Users/CHZ/Desktop/GCP-Second-hand-books/pages/school/school.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;;AA2BI,MAAK,UAAW,MAAW;AAE3B,MAAK,YAAU;AAAA,EACX,YAAY;AAAA,IACR;AAAA,EACH;AAAA,EACD,OAAO;AACH,WAAO;AAAA,MACH,YAAY;AAAA,MACZ,MAAM;AAAA,QAAC;AAAA,UACC,MAAM;AAAA,QACT;AAAA,QACD;AAAA,UACI,MAAM;AAAA,QACV;AAAA,MACH;AAAA,MACD,UAAU,CAAE;AAAA;AAAA,MACZ,UAAU,CAAI;AAAA;AAAA;EAErB;AAAA,EACD,UAAU;AAAA,IACN,eAAe;AAEX,YAAM,UAAU;AAAA,QACZ,GAAG;AAAA,QACH,GAAG;AAAA;AAEP,UAAI,CAAC,MAAM,QAAQ,KAAK,QAAQ;AAAG,eAAO;AAC1C,aAAO,KAAK,SAAS,OAAO,UAAQ,KAAK,SAAS,QAAQ,KAAK,UAAU,CAAC;AAAA,IAC9E;AAAA,EACH;AAAA,EACD,SAAS;AAAA,IACL,OAAO,GAAG;AACN,WAAK,aAAa,EAAE;AAAA,IACvB;AAAA,IACD,cAAc,MAAM;AAChBA,oBAAY,MAAA,MAAA,OAAA,iCAAA,uBAAuB,IAAI;AACvC,UAAI,WAAWA,cAAG,MAAC,eAAe,YAAY,KAAK,CAAA;AACnD,eAAS,KAAK,IAAI;AAClBA,oBAAAA,MAAI,eAAe,cAAc,QAAQ;AACzCA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MACV,CAAC;AAAA,IACL;AAAA,EACH;AAAA,EACD,SAAS;AAEL,UAAM,OAAOA,cAAAA,MAAI,eAAe,MAAM;AACtC,QAAI,CAAC,QAAQ,CAAC,KAAK,OAAO;AACtBA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,QACN,UAAU;AAAA,MACd,CAAC;AACD,iBAAW,MAAM;AACbA,sBAAAA,MAAI,WAAW,EAAE,KAAK,qBAAsB,CAAA;AAAA,MAC/C,GAAE,GAAG;AACN;AAAA,IACJ;AAEAA,kBAAAA,MAAI,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,QAAQ;AAAA,MACR,SAAS,CAAC,QAAQ;AACd,YAAI,MAAM,QAAQ,IAAI,IAAI,GAAG;AACzB,eAAK,WAAW,IAAI;AAAA,mBACb,IAAI,QAAQ,MAAM,QAAQ,IAAI,KAAK,IAAI,GAAG;AACjD,eAAK,WAAW,IAAI,KAAK;AAAA,eACtB;AACH,eAAK,WAAW;QACpB;AAAA,MACH;AAAA,MACD,MAAM,MAAM;AACRA,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAC;AACD,aAAK,WAAW;MACpB;AAAA,IACJ,CAAC;AACDA,kBAAAA,MAAI,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,QAAQ;AAAA,MACR,SAAS,CAAC,QAAQ;AACd,YAAI,MAAM,QAAQ,IAAI,IAAI,GAAG;AACzB,eAAK,WAAW,IAAI;AAAA,mBACb,IAAI,QAAQ,MAAM,QAAQ,IAAI,KAAK,IAAI,GAAG;AACjD,eAAK,WAAW,IAAI,KAAK;AAAA,eACtB;AACH,eAAK,WAAW;QACpB;AAAA,MACH;AAAA,MACD,MAAM,MAAM;AACRA,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAC;AACD,aAAK,WAAW;MACpB;AAAA,IACJ,CAAC;AAAA,EACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/HR,GAAG,WAAW,eAAe;"}