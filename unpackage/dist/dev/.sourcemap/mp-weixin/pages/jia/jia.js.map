{"version":3,"file":"jia.js","sources":["pages/jia/jia.vue","D:/develop/HBuilderX.4.24.2024072208/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvamlhL2ppYS52dWU"],"sourcesContent":["<template>\r\n    <view class=\"container\">\r\n        <view class=\"navbar\">\r\n            <view @click=\"switchPage('buy')\" :class=\"{ active: currentPage === 'buy' }\">我要买书</view>\r\n            <view @click=\"switchPage('sell')\" :class=\"{ active: currentPage === 'sell' }\">我要卖书</view>\r\n\r\n        </view>\r\n        <!-- 卖书表单 -->\r\n        <view class=\"form-box\" v-if=\"currentPage === 'sell'\">\r\n            <view class=\"panel\">\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">卖出书籍名称</view>\r\n                    <view class=\"input-box\">\r\n                        <input class=\"input\" placeholder=\"请输入书籍名称\" v-model=\"sellForm.bookName\" type=\"text\" />\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell image-box\">\r\n                    <view v-if=\"sellForm.bookImage\" class=\"preview-image\">\r\n                        <image :src=\"sellForm.bookImage\" mode=\"aspectFill\" style=\"width: 100px; height: 100px;\" />\r\n                    </view>\r\n                </view>\r\n                <button @click=\"chooseImage('sell')\">选择图片</button>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">校区</view>\r\n                    <view class=\"input-box\">\r\n                        <picker :value=\"sellForm.campusIndex\" :range=\"campuses\"\r\n                            @change=\"handleCampusChange('sell', $event)\">\r\n                            <view class=\"select\">{{ campuses[sellForm.campusIndex] }}</view>\r\n                        </picker>\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">价格</view>\r\n                    <view class=\"input-box\">\r\n                        <input class=\"input\" placeholder=\"请输入价格\" v-model=\"sellForm.bookPrice\" type=\"number\" />\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">电话</view>\r\n                    <view class=\"input-box\">\r\n                        <input class=\"input\" placeholder=\"请输入您的电话号码\" v-model=\"sellForm.bookPhone\" type=\"digit\" />\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">请输入卖书备注</view>\r\n                    <view class=\"input-box\">\r\n                        <textarea class=\"input\" v-model=\"sellForm.bookContact\" placeholder=\"请输入信息\"></textarea>\r\n                    </view>\r\n                </view>\r\n            </view>\r\n            <button type=\"primary\" size=\"default\"\r\n                :disabled=\"!(sellForm.bookName && sellForm.bookPhone && sellForm.bookImage && sellForm.bookContact && sellForm.bookPrice)\"\r\n                :loading=\"buttonLoading\" @click=\"submitBook('sell')\">\r\n                立即发布\r\n            </button>\r\n        </view>\r\n\r\n        <!-- 买书表单 -->\r\n        <view class=\"form-box\" v-if=\"currentPage === 'buy'\">\r\n            <view class=\"panel\">\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">想买书籍名称</view>\r\n                    <view class=\"input-box\">\r\n                        <input class=\"input\" placeholder=\"请输入书籍名称\" v-model=\"buyForm.bookName\" type=\"text\" />\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell image-box\">\r\n                    <view v-if=\"buyForm.bookImage\" class=\"preview-image\">\r\n                        <image :src=\"buyForm.bookImage\" mode=\"aspectFill\" style=\"width: 100px; height: 100px;\" />\r\n                    </view>\r\n                </view>\r\n                <button @click=\"chooseImage('buy')\">选择图片</button>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">校区</view>\r\n                    <view class=\"input-box\">\r\n                        <picker :value=\"buyForm.campusIndex\" :range=\"campuses\"\r\n                            @change=\"handleCampusChange('buy', $event)\">\r\n                            <view class=\"select\">{{ campuses[buyForm.campusIndex] }}</view>\r\n                        </picker>\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">价格</view>\r\n                    <view class=\"input-box\">\r\n                        <input class=\"input\" placeholder=\"请输入价格\" v-model=\"buyForm.bookPrice\" type=\"number\" />\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">电话</view>\r\n                    <view class=\"input-box\">\r\n                        <input class=\"input\" placeholder=\"请输入您的电话号码\" v-model=\"buyForm.bookPhone\" type=\"digit\" />\r\n                    </view>\r\n                </view>\r\n                <view class=\"cell\">\r\n                    <view class=\"label\">请输入想买书籍备注</view>\r\n                    <view class=\"input-box\">\r\n                        <textarea class=\"input\" v-model=\"buyForm.bookContact\" placeholder=\"请输入信息\"></textarea>\r\n                    </view>\r\n                </view>\r\n            </view>\r\n            <button type=\"primary\" size=\"default\"\r\n                :disabled=\"!(buyForm.bookName && buyForm.bookPhone && buyForm.bookImage && buyForm.bookContact && buyForm.bookPrice)\"\r\n                :loading=\"buttonLoading\" @click=\"submitBook('buy')\">\r\n                立即发布\r\n            </button>\r\n        </view>\r\n    </view>\r\n</template>\r\n\r\n<script setup>\r\n    import {\r\n        ref, onMounted\r\n    } from 'vue';\r\n    // 表单数据\r\n    const sellForm = ref({\r\n        bookName: '',\r\n        bookPrice: '',\r\n        campusIndex: 0,\r\n        bookPhone: '',\r\n        bookContact: '',\r\n        bookImage: ''\r\n    });\r\n\r\n    const buyForm = ref({\r\n        bookName: '',\r\n        bookPrice: '',\r\n        campusIndex: 0,\r\n        bookPhone: '',\r\n        bookContact: '',\r\n        bookImage: ''\r\n    });\r\n\r\n    const campuses = ['科教城西区', '科教城东区'];\r\n    const buttonLoading = ref(false);\r\n    const currentPage = ref('sell');\r\n\r\n    onMounted(() => {\r\n        const user = uni.getStorageSync('user');\r\n        if (!user || !user.title) {\r\n            uni.showToast({\r\n                title: '该功能需要登录后使用',\r\n                icon: 'none',\r\n                duration: 5000\r\n            });\r\n            setTimeout(() => {\r\n                uni.redirectTo({ url: '/pages/login/login' });\r\n            }, 200);\r\n        }\r\n    });\r\n\r\n    // 切换页面\r\n    function switchPage(page) {\r\n        currentPage.value = page;\r\n    }\r\n\r\n    // 处理校区选择变化\r\n    function handleCampusChange(type, event) {\r\n        if (type === 'sell') {\r\n            sellForm.value.campusIndex = event.detail.value;\r\n        } else if (type === 'buy') {\r\n            buyForm.value.campusIndex = event.detail.value;\r\n        }\r\n    }\r\n\r\n    // 选择图片\r\n    async function chooseImage(type) {\r\n        const result = await uni.chooseImage({\r\n            count: 1,\r\n            sizeType: ['compressed'],\r\n            sourceType: ['album', 'camera']\r\n        });\r\n        if (type === 'sell') {\r\n            sellForm.value.bookImage = result.tempFilePaths[0];\r\n        } else if (type === 'buy') {\r\n            buyForm.value.bookImage = result.tempFilePaths[0];\r\n        }\r\n    }\r\n\r\n    // 提交书籍信息到后端\r\n    async function submitBook(type) {\r\n        buttonLoading.value = true;\r\n        const form = type === 'sell' ? sellForm.value : buyForm.value;\r\n        const bookData = {\r\n            img: form.bookImage || 'https://tse3-mm.cn.bing.net/th/id/OIP-C.0-vJS5KbFZwCSWe-dWqKrwHaHa?w=168&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7',\r\n            title: `${form.bookName} ${form.bookPhone}`,\r\n            type: type === 'sell' ? '我要卖书' : '我要买书',\r\n            contact: form.bookContact,\r\n            image: form.bookImage,\r\n            xiaoqv: campuses[form.campusIndex],\r\n            jiage: parseFloat(form.bookPrice),\r\n            phone: parseInt(form.bookPhone),\r\n            name: form.bookName\r\n        };\r\n        uni.request({\r\n            url: 'http://localhost:3000/api/fabu',\r\n            method: 'POST',\r\n            data: bookData,\r\n            success: (res) => {\r\n                uni.showToast({ title: '发布成功', icon: 'success' });\r\n                setTimeout(() => {\r\n                    uni.showToast({ title: '请耐心等待管理员审核', icon: 'none', duration: 3000 });\r\n                }, 800);\r\n                // 清空表单\r\n                if (type === 'sell') {\r\n                    sellForm.value = { bookName: '', bookPrice: '', campusIndex: 0, bookPhone: '', bookContact: '', bookImage: '' };\r\n                } else {\r\n                    buyForm.value = { bookName: '', bookPrice: '', campusIndex: 0, bookPhone: '', bookContact: '', bookImage: '' };\r\n                }\r\n            },\r\n            fail: () => {\r\n                uni.showToast({ title: '发布失败', icon: 'none' });\r\n            },\r\n            complete: () => {\r\n                buttonLoading.value = false;\r\n            }\r\n        });\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    /* 基础样式 */\r\n    .container {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 100vh;\r\n        background-color: #f9f9f9;\r\n    }\r\n\r\n    .navbar {\r\n        display: flex;\r\n        height: 110rpx;\r\n        text-align: center;\r\n        margin-top: 10rpx;\r\n        line-height: 70rpx;\r\n        justify-content: space-around;\r\n        background-color: #ffffff;\r\n        box-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.1);\r\n        z-index: 1;\r\n    }\r\n\r\n    .navbar view {\r\n        padding: 10rpx 20rpx;\r\n        border: none;\r\n        outline: none;\r\n        background-color: transparent;\r\n        transition: all 0.3s ease;\r\n    }\r\n\r\n    .navbar .active {\r\n        color: #ffffff;\r\n        margin-top: 15rpx;\r\n        height: 60rpx;\r\n        background-color: #328d64;\r\n        border-radius: 40rpx;\r\n        font-weight: bold;\r\n    }\r\n\r\n    .content {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 20rpx;\r\n    }\r\n\r\n    .form-box {\r\n        padding: 32rpx;\r\n        background-color: #ffffff;\r\n        border-radius: 16rpx;\r\n        box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.05);\r\n        margin-bottom: 32rpx;\r\n    }\r\n\r\n    .panel {\r\n        margin-top: 32rpx;\r\n    }\r\n\r\n    .cell {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 24rpx 32rpx;\r\n        border-bottom: 1rpx solid #ebedf0;\r\n    }\r\n\r\n    .cell:last-child {\r\n        border-bottom: none;\r\n    }\r\n\r\n    .label {\r\n        text-align: left;\r\n        width: 150rpx;\r\n        font-size: 24rpx;\r\n        color: #333333;\r\n    }\r\n\r\n    .input-box {\r\n        flex: 1;\r\n        margin-left: 16rpx;\r\n    }\r\n\r\n    .input {\r\n        width: 100%;\r\n        height: 50rpx;\r\n        padding: 10rpx;\r\n        border: 1rpx solid #dcdfe6;\r\n        border-radius: 4rpx;\r\n        font-size: 24rpx;\r\n        color: #606266;\r\n    }\r\n\r\n    .textarea {\r\n        width: 100%;\r\n        height: 100rpx;\r\n        padding: 10rpx;\r\n        border: 1rpx solid #dcdfe6;\r\n        border-radius: 4rpx;\r\n        font-size: 24rpx;\r\n        color: #606266;\r\n        resize: none;\r\n    }\r\n\r\n    .image-box {\r\n        position: relative;\r\n        display: flex;\r\n        justify-content: center;\r\n        margin-left: 250rpx;\r\n        width: 120rpx;\r\n        margin-top: 20rpx;\r\n        margin-bottom: 20rpx;\r\n        height: 150rpx;\r\n        border: 1rpx solid #dcdfe6;\r\n        border-radius: 8rpx;\r\n        box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.05);\r\n        overflow: hidden;\r\n    }\r\n\r\n    .preview-image {\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n    }\r\n\r\n    .select {\r\n        width: 100%;\r\n        height: 50rpx;\r\n        padding: 10rpx;\r\n        border: 1rpx solid #dcdfe6;\r\n        border-radius: 4rpx;\r\n        font-size: 24rpx;\r\n        color: #606266;\r\n        background-color: #ffffff;\r\n    }\r\n\r\n    .button {\r\n        width: 200rpx;\r\n        height: 50rpx;\r\n        margin-top: 20rpx;\r\n        background-color: #40a9ff;\r\n        color: #ffffff;\r\n        border: none;\r\n        border-radius: 4rpx;\r\n        font-size: 28rpx;\r\n        cursor: pointer;\r\n        transition: all 0.3s ease;\r\n    }\r\n\r\n    .button:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n    }\r\n\r\n    .button.loading::after {\r\n        content: '';\r\n        display: inline-block;\r\n        width: 16rpx;\r\n        height: 16rpx;\r\n        border: 2rpx solid #ffffff;\r\n        border-top-color: transparent;\r\n        border-radius: 50%;\r\n        animation: spin 1s linear infinite;\r\n        margin-left: 10rpx;\r\n    }\r\n\r\n    @keyframes spin {\r\n        to {\r\n            transform: rotate(360deg);\r\n        }\r\n    }\r\n</style>","import MiniProgramPage from 'C:/Users/CHZ/Documents/GitHub/GCP-Second-hand-books/pages/jia/jia.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni"],"mappings":"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"}